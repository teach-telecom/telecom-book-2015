# Internet Protocol version 4

**IP-адреса (Internet Protocol version 4, интернет протокол версии 4)** – представляют собой основной тип адресов, используемый на сетевом уровне модели OSI, для осуществления передачи пакетов между сетями. IP-адреса состоят из четырех байт, к примеру 192.168.100.111.

 
   Присвоение IP-адресов хостам осуществляется:
   
- вручную, настраивается системным администратором во время настройки вычислительной сети;
- автоматически, с использование специальных протоколов (в частности, с помощью протокола DHCP - Dynamic Host Configuration Protocol, протокол динамической настройки хостов).

**Протокол IPv4** разработан в сентябре 1981 года.

**Протокол IPv4** работает на межсетевом (сетевом) уровне стека протокола TCP/IP.

Основной задачей протокола является осуществление передачи блоков данных (дейтаграмм) от хоста-отправителя, до хоста-назначения, где отправителями и получателями выступают вычислительные машины, однозначно идентифицируемые адресами фиксированной длины (IP-адресами). Также интернет протокол IP осуществляет, в случае необходимости, фрагментацию и сбору отправляемых дейтаграмм для передачи данных через другие сети с меньшим размером пакетов.

Недостатком протокола IP является ненадежность протокола, то есть перед началом передачи не устанавливается соединение, это говорит о том, что не подтверждается доставка пакетов, не осуществляется контроль корректности полученных данных (с помощью контрольной суммы) и не выполняется операция квитирования (обмен служебными сообщения с узлом-назначения и его готовностью приема пакетов).

Протокол IP отправляет и обрабатывает каждую дейтаграмму как независимую порцию данных, то есть не имея никаких других связей с другими дейтаграммами в глобальной сети интернет.

После отправки дейтаграммы протоколом IP в сеть, дальнейшие действия с этой дейтаграммой никак не контролируются отправителем. Получается, что если дейтаграмма, по каким-либо причинам, не может быть передана дальше по сети, она уничтожается. Хотя узел, уничтоживший дейтаграмму, имеет возможность сообщить о причине сбоя отправителю, по обратному адресу (в частности с помощью протокола ICMP). Гарантию доставки данных возложены на протоколы вышестоящего уровня (транспортный уровень), которые наделены для этого специальными механизмами (протокол TCP).

Как известно, на сетевом уровне модели OSI работают маршрутизаторы. Поэтому, одной из самых основных задач протокола IP – это осуществление маршрутизации дейтаграмм, другими словами, определение оптимального пути следования дейтаграмм (с помощью алгоритмов маршрутизации) от узла-отправителя сети к любому другому узлу сети на основании IP адреса.

Алгоритм работы протокола ip на каком-либо узле сети принимающего дейтаграмму из сети выглядит следующим образом:



[![Блок-схема1](http://imgur.com/8CVVG8v)](http://imgur.com/8CVVG8v)


### Формат заголовка IP
Структура IP пакетов версии 4 представлена на рисунке:

[![Структура](http://imgur.com/LkekP1m)](http://imgur.com/LkekP1m)

•	Версия — для IPv4 значение поля должно быть равно 4.

•	IHL — (Internet Header Length) длина заголовка IP-пакета в 32-битных словах (dword). Именно это поле указывает на начало блока данных в пакете. Минимальное корректное значение для этого поля равно 5.

•	Тип обслуживания (Type of Service, акроним TOS) — байт, содержащий набор критериев, определяющих тип обслуживания IP-пакетов, представлен на рисунке.

[![Приоритет](http://imgur.com/XlnxftT)](http://imgur.com/XlnxftT)

  Описание байта обслуживания побитно:
  
•	0-2 — приоритет (precedence) данного IP-сегмента

•	3 — требование ко времени задержки (delay) передачи IP-сегмента (0 — нормальная, 1 — низкая задержка)

•	4 — требование к пропускной способности (throughput) маршрута, по которому должен отправляться IP-сегмент (0 — низкая, 1 — высокая пропускная способность)

•	5 — требование к надежности (reliability) передачи IP-сегмента (0 — нормальная, 1 — высокая надежность)

•	6-7 — ECN — явное сообщение о задержке (управление IP-потоком).

1.	Длина пакета - длина пакета в октетах, включая заголовок и данные. Минимальное корректное значение для этого поля равно 20, максимальное 65535.
2.	Идентификатор — значение, назначаемое отправителем пакета и предназначенное для определения корректной последовательности фрагментов при сборке пакета. Для фрагментированного пакета все фрагменты имеют одинаковый идентификатор.
3.	3 бита флагов. Первый бит должен быть всегда равен нулю, второй бит DF (don’t fragment) определяет возможность фрагментации пакета и третий бит MF (more fragments) показывает, не является ли этот пакет последним в цепочке пакетов.
4.	Смещение фрагмента — значение, определяющее позицию фрагмента в потоке данных. Смещение задается количеством восьми байтовых блоков, поэтому это значение требует умножения на 8 для перевода в байты.
5.	Время жизни (TTL) — число маршрутизаторов, которые должен пройти этот пакет. При прохождении маршрутизатора это число уменьшатся на единицу. Если значения этого поля равно нулю то, пакет должен быть отброшен и отправителю пакета может быть послано сообщение Time Exceeded (ICMP код 11 тип 0).
6.	Протокол — идентификатор интернет-протокола следующего уровня указывает, данные какого протокола содержит пакет, например, TCP или ICMP.
7.	Контрольная сумма заголовка — вычисляется в соответствии с RFC 1071

Перехваченный IPv4 пакет с помощью сниффера Wireshark:

[![WireShark](http://imgur.com/QVdcLzC)](http://imgur.com/QVdcLzC)

### Фрагментация IP пакетов

На пути пакета от отправителя к получателю могут встречаться локальные и глобальные сети разных типов с разными допустимыми размерами полей данных кадров канального уровня (Maximum Transfer Unit – MTU). Так, сети Ethernet могут передавать кадры, несущие до 1500 байт данных, для сетей X.25 характерен размер поля данных кадра в 128 байт, сети FDDI могут передавать кадры размером в 4500 байт, в других сетях действуют свои ограничения. Протокол IP умеет передавать дейтаграммы, длина которых больше MTU промежуточной сети, за счет фрагментирования – разбиения “большого пакета” на некоторое количество частей (фрагментов), размер каждой из которых удовлетворяет промежуточную сеть. После того, как все фрагменты будут переданы через промежуточную сеть, они будут собраны на узле-получателе модулем протокола IP обратно в “большой пакет”. Отметим, что сборку пакета из фрагментов осуществляет только получатель, а не какой-либо из промежуточных маршрутизаторов. Маршрутизаторы могут только фрагментировать пакеты, но не собирать их. Это связано с тем, что разные фрагменты одного пакета не обязательно будут проходить через одни и те же маршрутизаторы.

 Для того, чтобы не перепутать фрагменты разных пакетов, используется поле Идентификации, значение которого должно быть одинаковым для всех фрагментов одного пакета и не повторяться для разных пакетов, пока у обоих пакетов не истекло время жизни. При делении данных пакета, размер всех фрагментов, кроме последнего, должен быть кратен 8 байтам. Это позволяет отвести меньше места в заголовке под поле Смещение фрагмента.
 
Второй бит поля Флаги (More fragments), если равен единице, указывает на то, что данный фрагмент – не последний в пакете. Если пакет отправляется без фрагментации, флаг “More fragments” устанавливается в 0, а поле Смещение фрагмента – заполняется нулевыми битами.
    
 Если первый бит поля Флаги (Don’t fragment) равен единице, то фрагментация пакета запрещена. Если этот пакет должен быть передан через сеть с недостаточным MTU, то маршрутизатор вынужден будет его отбросить (и сообщить об этом отправителю посредством протокола ICMP). Этот флаг используется в случаях, когда отправителю известно, что у получателя нет достаточно ресурсов по восстановлению пакетов из фрагментов.
    
### Классы IP адресов

  Все IP-адреса можно разделить на две логические части — номера сети и номера узла сети (номер хоста). Чтобы определить какая именно часть IP-адреса принадлежит к номеру сети, а какая — к номеру хоста, определяется значениями первых бит адреса. Также, первые биты IP-адреса используются для того, чтобы определить к какому классу относится тот или другой IP-адрес.
  
  На рисунке показана структура IP-адреса разных классов.
  
  [![Классы](http://imgur.com/pjn5eXY)](http://imgur.com/pjn5eXY)
  
Если адрес начинается с 0, то сеть относят к классу А и номер сети занимает один байт, остальные 3 байта интерпретируются как номер узла в сети. Сети класса А имеют номера в диапазоне от 1 до 126. (Номер 0 не используется, а номер 127 зарезервирован для специальных целей, о чем будет сказано ниже.) Сетей класса А немного, зато количество узлов в них может достигать 224, то есть 16 777 216 узлов.

Если первые два бита адреса равны 10, то сеть относится к классу В. В сетях класса В под номер сети и под номер узла отводится по 16 бит, то есть по 2 байта. Таким образом, сеть класса В является сетью средних размеров с максимальным числом узлов 216, что составляет 65 536 узлов.

Если адрес начинается с последовательности 110, то это сеть класса С. В этом случае под номер сети отводится 24 бита, а под номер узла — 8 бит. Сети этого класса наиболее распространены, число узлов в них ограничено 28, то есть 256 узлами.
 
Если адрес начинается с последовательности 1110, то он является адресом класса Dи обозначает особый, групповой адрес — multicast. Если в пакете в качестве адреса назначения указан адрес класса D, то такой пакет должны получить все узлы, которым присвоен данный адрес. 

Если адрес начинается с последовательности 11110, то это значит, что данный адрес относится к классу Е. Адреса этого класса зарезервированы для будущих применений.

В таблице приведены диапазоны номеров сетей и максимальное число узлов, соответствующих каждому классу сетей.

 [![Классы2](http://imgur.com/uZfuE1A)](http://imgur.com/uZfuE1A)
 
 Большие сети получают адреса класса А, средние — класса В, а маленькие — класса С.
 
### Бесклассовая адресация (CIDR)

Изначально адресация в IP-сетях осуществлялась по классовому принципу (существовали классы, которые делили адресное пространство на большие блоки). Тем не менее данная схема оказалась непрактичной и сегодня в Интернет используется бесклассовая адресация, известная как Classless Inter-Domain Routing, или сокращенно CIDR.

В целом, CIDR позволяет описывать блоки IP-адресов для Интернет-подсетей. Так, стандартной считается запись CIDR в виде IP-адреса, следующего за ним символа "/" и число, обозначающее битовую маску подсети, например, 12.13.14.0/24

Число 24 в данном случае будет означать количество старших битов в маске подсети. Так как IP-адрес состоит из 32 бит, но маской являются старшие 24, это значит, что для всех возможных адресов в сети остается 32 - 24 = 8 бит. То есть 28 = 256 возможных. Или, если наша маска была бы 23 бита а не 24, то для адресов осталось бы 9 бит = 29 = 512 возможных, и напротив, если маска будет 25 бит, то для адресов останется 232-25 = 27 = 128 возможных. Таким образом, мы можем описывать сети, состоящие из различного количества доступных адресов. Кроме того, одна большая сеть может быть внутри опять раздроблена на несколько более мелких подсетей, те в свою очередь могут быть также разбиты на подсети и т.д.

Следует отметить, что количество возможных узлов (хостов) в подсети всегда минимум на 2 меньше количества всех возможных адресов. Обусловлено это тем, что первый адрес резервируется, как идентификатор сети, а последний является широковещательным.

### NAT — трансляция сетевого адреса

IP-адреса являются дефицитным ресурсом. У провайдера может быть /16-адрес (бывший класс В), дающий возможность подключить 65 534 хоста. Если клиентов становится больше, начинают возникать проблемы.

Этот дефицит ресурсов стал причиной появления методов эффективного использования **IP-адресов. Идея одного из подходов заключается в том**, что IP-адрес выделяется компьютеру, который в данный момент включен и подключен к сети; когда этот компьютер становится неактивным, его адрес присваивается новому соединению. В таком случае один /16-адрес будет обслуживать до 65 534 активных пользователей.

Такая стратегия в некоторых ситуациях работает хорошо — например, при подключении к сети через телефон, для мобильных и других ПК, где соединение или питание могут временно отсутствовать. Но если заказчиком является организация, эта стратегия, как правило, не подходит. Дело в том, что корпоративные клиенты предпочитают, чтобы компьютеры работали постоянно. Некоторые компьютеры являются рабочими станциями сотрудников, и данные с них резервируются в ночное время, а некоторые служат веб-серверами и поэтому должны уметь незамедлительно отвечать на любой удаленный запрос. Такие организации обладают линией доступа, обеспечивающей постоянное соединение с Интернетом. 

Проблема усугубляется еще и тем, что все большее число частных пользователей желают иметь ADSL или кабельное соединение с Интернетом, поскольку при этом 5.6. Сетевой уровень в Интернете 485 отсутствует повременная оплата (взимается только ежемесячная абонентская плата). Многие такие пользователи имеют дома два и более компьютера (например, по одному на каждого члена семьи) и хотят, чтобы все машины имели постоянный выход в Интернет. Решение таково: необходимо установить (беспроводной) маршрутизатор и объединить все компьютеры в домашнюю локальную сеть. А уже маршрутизатор должен быть подключен к провайдеру. С точки зрения провайдера, в этом случае семья будет выступать в качестве аналога маленькой фирмы с несколькими компьютерами. Добро пожаловать в **Jones, Inc! Если использовать обычные схемы, то каждый компьютер** будет сохранять свой IP-адрес в течение всего дня. Но для интернет-провайдеров с несколькими тысячами клиентов (многие из которых представляют собой целые организации или семьи, также похожие на небольшие организации) такая ситуация недопустима, так как IP-адресов попросту не хватит. Проблема дефицита IP-адресов отнюдь не теоретическая и отнюдь не относится к отдаленному будущему. Она уже актуальна и бороться с ней приходится здесь и сейчас. В долгосрочной перспективе решением будет тотальный перевод всего Интернета на протокол IPv6 со 128-битной адресацией. Этот переход действительно постепенно происходит, но процесс идет настолько медленно, что затягивается на годы. Видя это, многие поняли, что нужно срочно найти какое-нибудь решение хотя бы на ближайшее время. Такое решение было найдено и сейчас широко используется: это метод **трансляции сетевого адреса, NAT (Network Address Translation)**, описанный в RFC 3022. Суть его мы рассмотрим ниже, а более подробную информацию можно найти в (Dutcher, 2001).

Основная идея трансляции сетевого адреса состоит в присвоении каждой фирме или семье одного IP-адреса (или, по крайней мере, небольшого числа адресов) для интернет-трафика. Внутри абонентской сети каждый компьютер получает уникальный IP-адрес, используемый для маршрутизации внутреннего трафика. Однако, как только пакет покидает пределы абонентской сети и направляется к провайдеру, выполняется трансляция адреса, при которой уникальный внутренний IP-адрес становится общим публичным IP-адресом. Для реализации этой схемы было создано три диапазона так называемых частных IP-адресов. Они могут использоваться внутри сети по ее усмотрению. Единственное ограничение заключается в том, что пакеты с такими адресами ни в коем случае не должны появляться в самом Интернете. Вот эти три зарезервированных диапазона:

- 10.0.0.0 – 10.255.255.255/8 (16 777 216 хостов)
- 172.16.0.0 – 172.31.255.255/12 (1 048 576 хостов)
- 192.168.0.0 – 192.168.255.255/16 (65 536 хостов) 

Итак, первый диапазон может обеспечить адресами 16 777 216 хостов (кроме всех 0 и всех 1, как обычно), и именно его обычно предпочитают абоненты, причем даже для небольших сетей.

Работа метода трансляции сетевых адресов показана на рис. 5.48. В пределах территории абонента у каждой машины имеется собственный уникальный адрес вида 10.x.y.z. Тем не менее, перед тем как пакет выходит за пределы владений абонента, он проходит через NAT-блок (NAT box), транслирующий внутренний IP-адрес источника (10.0.0.1 на рисунке) в реальный IP-адрес, полученный абонентом от провайдера (198.60.42.12 для нашего примера). NAT-блок обычно представляет собой единое устройство с межсетевым экраном, обеспечивающим безопасность путем строгого 486 Глава 5. Сетевой уровень отслеживания входящего и исходящего трафика абонентской сети. Межсетевые экраны мы будем изучать отдельно в главе 8. NAT-блок может быть также интегрирован с маршрутизатором или модемом ADSL.

Когда процесс желает установить TCP-соединение с удаленным процессом, он связывается со свободным TCP-портом на собственном компьютере. Этот порт становится портом источника (source port), который сообщает TCP-коду информацию о том, куда направлять пакеты данного соединения. Процесс также определяет порт назначения (destination port). Посредством порта назначения сообщается, кому отдать пакет на удаленной стороне. Порты с 0 по 1023 зарезервированы для хорошо известных сервисов. Например, 80-й порт используется веб-серверами, соответственно, на них могут ориентироваться удаленные клиенты. Каждое исходящее сообщение TCP содержит информацию о порте источника и порте назначения. Вместе они служат для идентификации процессов на обоих концах, использующих соединение. 

Проведем аналогию, которая несколько прояснит принцип использования портов. Допустим, у компании есть один общий телефонный номер. Когда люди набирают его, 5.6. Сетевой уровень в Интернете 487 они слышат голос оператора, который спрашивает, с кем именно они хотели бы соединиться, и подключают их к соответствующему добавочному телефонному номеру. Основной телефонный номер является аналогией IP-адреса абонента, а добавочные на обоих концах аналогичны портам. Для адресации портов используется 16-битное поле, которое идентифицирует процесс, получающий входящий пакет. 

С помощью поля Порт источника мы можем решить проблему отображения адресов. Когда исходящий пакет приходит в NAT-блок, адрес источника вида 10.x.y.z заменяется настоящим IP-адресом. Кроме того, поле Порт источника TCP заменяется индексом таблицы перевода NAT-блока, содержащей 65 536 записей. Каждая запись содержит исходный IP-адрес и номер исходного порта. Наконец, пересчитываются и вставляются в пакет контрольные суммы заголовков TCP и IP. Необходимо заменять поле Порт источника, потому что машины с местными адресами 10.0.0.1 и 10.0.0.2 могут случайно пожелать воспользоваться одним и тем же портом (5000-м, например). Так что для однозначной идентификации процесса отправителя одного поля Порт источника оказывается недостаточно. 

Когда пакет прибывает на NAT-блок со стороны провайдера, извлекается значение поля Порт источника заголовка TCP. Оно используется в качестве индекса таблицы отображения NAT-блока. По найденной в этой таблице записи определяются внутренний IP-адрес и настоящий Порт источника TCP. Эти два значения вставляются в пакет. Затем заново подсчитываются контрольные суммы TCP и IP. Пакет передается на главный маршрутизатор абонента для нормальной доставки с адресом вида 10.x.y.z. 

Хотя описанная выше схема частично решает проблему нехватки IP-адресов, сетевые пуристы из IP-сообщества рассматривают NAT как некую заразу, распространяющуюся по Земле. И их можно понять.

Во-первых, сам принцип трансляции сетевых адресов никак не вписывается в архитектуру IP, которая подразумевает, что каждый IP-адрес уникальным образом идентифицирует только одну машину в мире. Вся программная структура Интернета построена на использовании этого факта. При трансляции сетевых адресов получается, что тысячи машин могут (и так происходит в действительности) иметь адрес 10.0.0.1.

Во-вторых, NAT нарушает «сквозной» принцип, согласно которому каждый хост должен уметь отправлять пакет любому другому хосту в любой момент времени. Поскольку отображение адресов в NAT-блоке задается исходящими пакетами, входящие пакеты не принимаются до тех пор, пока не отправлены исходящие. На деле это означает, что пользователь домашней сети с NAT может создать TCP/IP-соединение с удаленным сервером, но удаленный пользователь не может подключиться к игровому серверу в домашней сети. Чтобы это было возможным, необходимы специальные настройки или технология **NAT Traversal**.

В-третьих, NAT превращает Интернет из сети без установления соединения в нечто подобное сети, ориентированной на соединение. Проблема в том, что NAT-блок должен поддерживать таблицу отображения для всех соединений, проходящих через него. Запоминать состояние соединения — дело сетей, ориентированных на соединение, но никак не сетей без установления соединений. Если NAT-блок ломается и теряются его таблицы отображения, то про все TCP-соединения, проходящие через него, можно забыть. При отсутствии трансляции сетевых адресов выход из строя или перезагрузка маршрутизатора не оказывает никакого эффекта на TCP-соединение. 488 Глава 5. Сетевой уровень Отправляющий процесс просто выжидает несколько секунд и посылает заново все неподтвержденные пакеты. При использовании NAT Интернет становится таким же восприимчивым к сбоям, как сеть с коммутацией каналов. 

В-четвертых, NAT нарушает одно из фундаментальных правил построения многоуровневых протоколов: уровень k не должен строить никаких предположений относительно того, что именно уровень k + 1 поместил в поле полезной нагрузки. Этот принцип определяет независимость уровней друг от друга. Если когда-нибудь на смену ТСР придет ТСР-2, у которого будет другой формат заголовка (например, 32-битная адресация портов), то трансляция сетевых адресов потерпит фиаско. Вся идея многоуровневых протоколов состоит в том, чтобы изменения в одном из уровней никак не могли повлиять на остальные уровни. NAT разрушает эту независимость. 

В-пятых, процессы в Интернете вовсе не обязаны использовать только TCP или UDP. Если пользователь машины А решит придумать новый протокол транспортного уровня для общения с пользователем машины В (это может быть сделано, например, для какого-нибудь мультимедийного приложения), то ему придется как-то бороться с тем, что NAT-блок не сможет корректно обработать поле Порт источника TCP. 

В-шестых, некоторые приложения предусматривают использование множественных TCP/IP-соединений или UDP-портов. Так, FTP, стандартный Протокол передачи файлов (File Transfer Protocol), вставляет IP-адрес в тело пакета, чтобы затем получатель извлек его оттуда и обработал. Так как NAT об этом ничего не знает, он не сможет переписать адрес или как-то иначе его обработать. Это значит, что FTP и другие приложения, такие как протокол интернет-телефонии H.323 (мы будем изучать его в главе 7), могут отказаться работать при трансляции сетевых адресов, если только не будут приняты специальные меры. Часто существует возможность улучшить метод NAT и заставить его корректно работать в таких случаях, но невозможно же дорабатывать его всякий раз, когда появляется новое приложение.

Наконец, поскольку поле Порт источника является 16-разрядным, то на один IP-адрес может быть отображено примерно 65 536 местных адресов машин. На самом деле, это число несколько меньше: первые 4096 портов зарезервированы для служебных нужд. В общем, если есть несколько IP-адресов, то каждый из них может поддерживать до 61 440 местных адресов. 

Эти и другие проблемы, связанные с трансляцией сетевых адресов, обсуждаются в RFC 2993. Несмотря на все трудности, NAT представляет собой единственный работающий механизм борьбы с дефицитом IP-адресов. Поэтому он широко используется на практике, особенно в домашних сетях и сетях небольших организаций. В NAT сейчас существуют межсетевые экраны и средства обеспечения конфиденциальности, поскольку по умолчанию блокируются все незапрошенные входящие пакеты. Поэтому маловероятно, что эта технология уйдет из употребления после внедрения IPv6.

### Использование масок в IP адресации

Для того, чтобы получить тот или иной диапазон IP-адресов предприятиям предлагалось заполнить регистрационную форму, в которой перечислялось текущее число ЭВМ и планируемое увеличение количества вычислительных машин и в итоге предприятию выдавался класс IP – адресов: A, B, C, в зависимости от указанных данных в регистрационной форме.

Данный механизм выдачи диапазонов IP-адресов работал штатно, это было связано с тем, что поначалу в организациях было небольшое количество ЭВМ и соответственно небольшие вычислительные сети. Но в связи с дальнейшим бурным ростом интернета и сетевых технологий описанный подход к распределению IP-адресов стал выдавать сбои, в основном связанные с сетями класса «B». Действительно, организациям, в которых число компьютеров не превышало нескольких сотен (скажем, 500), приходилось регистрировать для себя целую сеть класса «В» (так как класс «С» только для 254 компьютеров, а класс «В» - 65534). Из-за чего доступных сетей класса «В» стало, просто на просто, не хватать, но при этом большие диапазоны IP-адресов пропадали зря.

Традиционная схема деления IP-адреса на номер сети (NetID) и номер узла (HostID) основана на понятии класса, который определяется значениями нескольких первых бит адреса. Именно потому, что первый байт адреса 185.23.44.206 попадает в диапазон 128-191, мы можем сказать, что этот адрес относится к классу В, а значит, номером сети являются первые два байта, дополненные двумя нулевыми байтами — 185.23.0.0, а номером узла — 0.0.44.206.

А что если использовать какой-либо другой признак, с помощью которого можно было бы более гибко устанавливать границу между номером сети и номером узла? В качестве такого признака сейчас получили широкое распространение маски.

Маска — это число, которое используется в паре с IP-адресом; двоичная запись маски содержит единицы в тех разрядах, которые должны в IP-адресе интерпретироваться как номер сети. Поскольку номер сети является цельной частью адреса, единицы в маске также должны представлять непрерывную последовательность.

  Для стандартных классов сетей маски имеют следующие значения:
- класс А - 11111111. 00000000. 00000000. 00000000 (255.0.0.0);
- класс В - 11111111. 11111111. 00000000. 00000000 (255.255.0.0);
- класс С - 11111111. 11111111.11111111. 00000000 (255.255.255.0).

Снабжая каждый IP-адрес маской, можно отказаться от понятий классов адресов и сделать более гибкой систему адресации. Например, если рассмотренный выше адрес 185.23.44.206 ассоциировать с маской 255.255.255.0, то номером сети будет 185.23.44.0, а не 185.23.0.0, как это определено системой классов.

  Расчет номера сети и номера узла с помощью маски:

 [![Виды](http://imgur.com/9e9RjTu)](http://imgur.com/9e9RjTu)
 
   В масках количество единиц в последовательности, определяющей границу но¬мера сети, не обязательно должно быть кратным 8, чтобы повторять деление адреса на байты. Пусть, например, для IP-адреса 129.64.134.5 указана маска 255.255.128.0, то есть в двоичном виде:
   
•	IP-адрес 129.64.134.5 - 10000001. 01000000.10000110. 00000101

•	Маска 255.255.128.0 - 11111111.11111111.10000000. 00000000

Если игнорировать маску, то в соответствии с системой классов адрес 129.64.134.5 относится к классу В, а значит, номером сети являются первые 2 байта — 129.64.0.0, а номером узла — 0.0.134.5.

Если же использовать для определения границы номера сети маску, то 17 последовательных единиц в маске, «наложенные» (логическое умножение) на IP-адрес, определяют в качестве номера сети в двоичном выражении число:

 [![Преобразования](http://imgur.com/SCZmqS0)](http://imgur.com/SCZmqS0)
 
 или в десятичной форме записи — номер сети 129.64.128.0, а номер узла 0.0.6.5.
 
Существует также короткий вариант записи маски, называемый префиксом или короткой маской. В частности сеть 80.255.147.32 с маской 255.255.255.252, можно записать в виде 80.255.147.32/30, где «/30» указывает на количество двоичных единиц в маске, то есть тридцать бинарных единиц (отсчет ведется слева направо).

Для наглядности в таблице отображается соответствие префикса с маской:

 [![Маски,Префиксы,Кол-во узлов в сети](http://imgur.com/0woOH4q)](http://imgur.com/0woOH4q)
 
Механизм масок широко распространен в IP-маршрутизации, причем маски могут использоваться для самых разных целей. С их помощью администратор может структурировать свою сеть, не требуя от поставщика услуг дополнительных номеров сетей. На основе этого же механизма поставщики услуг могут объединять адресные пространства нескольких сетей путем введения так называемых «префиксов» с целью уменьшения объема таблиц маршрутизации и повышения за счет этого производительности маршрутизаторов. Помимо этого записывать маску в виде префикса значительно короче.

### Особые IP адреса

  В протоколе IP существует несколько соглашений об особой интерпретации IP-адресов:
  
•	0.0.0.0 - представляет адрес шлюза по умолчанию, т.е. адрес компьютера, которому следует направлять информационные пакеты, если они не нашли адресата в локальной сети (таблице маршрутизации);

•	255.255.255.255 – широковещательный адрес. Сообщения, переданные по этому адресу, получают все узлы локальной сети, содержащей компьютер-источник сообщения (в другие локальные сети оно не передается);

•	«Номер сети».«все нули» – адрес сети (например 192.168.10.0);

•	«Все нули».«номер узла» – узел в данной сети (например 0.0.0.23). Может использоваться для передачи сообщений конкретному узлу внутри локальной сети;

•	Если в поле номера узла назначения стоят только единицы, то пакет, имеющий такой адрес, рассылается всем узлам сети с заданным номером сети. Например, пакет с адресом 192.190.21.255 доставляется всем узлам сети 192.190.21.0. Такая рассылка называется широковещательным сообщением (broadcast). При адресации необходимо учитывать те ограничения, которые вносятся особым назначением некоторых IP-адресов. Так, ни номер сети, ни номер узла не может состоять только из одних двоичных единиц или только из одних двоичных нулей. Отсюда следует, что максимальное количество узлов, приведенное в таблице для сетей каждого класса, на практике должно быть уменьшено на 2. Например, в сетях класса С под номер узла отводится 8 бит, которые позволяют задавать 256 номеров: от 0 до 255. Однако на практике максимальное число узлов в сети класса С не может превышать 254, так как адреса 0 и 255 имеют специальное назначение. Из этих же соображений следует, что конечный узел не может иметь адрес типа 98.255.255.255, поскольку номер узла в этом адресе класса А состоит из одних двоичных единиц.

•	Особый смысл имеет IP-адрес, первый октет которого равен 127.х.х.х. Он используется для тестирования программ и взаимодействия процессов в пределах одной машины. Когда программа посылает данные по IP-адресу 127.0.0.1, то образуется как бы «петля». Данные не передаются по сети, а возвращаются модулям верхнего уровня как только что принятые. Поэтому в IP-сети запрещается присваивать машинам IP-адреса, начинающиеся со 127. Этот адрес имеет названиеloopback. Можно отнести адрес 127.0.0.0 ко внутренней сети модуля маршрутизации узла, а адрес 127.0.0.1 — к адресу этого модуля на внутренней сети. На самом деле любой адрес сети 127.0.0.0 служит для обозначения своего модуля маршрутизации, а не только 127.0.0.1, например 127.0.0.3.

В протоколе IP нет понятия широковещательности в том смысле, в котором оно используется в протоколах канального уровня локальных сетей, когда данные должны быть доставлены абсолютно всем узлам. Как ограниченный широковещательный IP-адрес, так и широковещательный IP-адрес имеют пределы распространения в интерсети — они ограничены либо сетью, к которой принадлежит узел-источник пакета, либо сетью, номер которой указан в адресе назначения. Поэтому деление сети с помощью маршрутизаторов на части локализует широковещательный шторм пределами одной из составляющих общую сеть частей просто потому, что нет способа адресовать пакет одновременно всем узлам всех сетей составной сети.

### Групповые адреса IPv4

Групповые адреса IPv4 используются для единичной доставки пакета от одного адреса нескольким адресам. В интрасети с поддержкой многоадресной рассылки IPv4 пакет IPv4, направленный на групповой адрес IPv4, переадресуется маршрутизаторами подсетям. Он переадресуется подсетям, где размещены узлы, прослушивающие трафик, который был послан на групповой адрес IPv4. Многоадресная рассылка IPv4 обеспечивает эффективную доставку данных от одного источника нескольким получателям, применяемую в различных типах связи.

Групповые адреса IPv4 определяются классом D адресов Интернета: 224.0.0.0/4. Групповые адреса IPv4 входят в диапазон от 224.0.0.0 до 239.255.255.255. Групповые адреса IPv4 для префикса адреса 224.0.0.0/24 (224.0.0.0–224.0.0.255) зарезервированы для группового трафика локальной подсети.

**Широковещательные адреса IPv4**

Протокол IPv4 использует набор широковещательных адресов для обеспечения доставки от одного адреса всем адресам в рамках подсети. Пакеты, отправляемые на широковещательные адреса IPv4, обрабатываются всеми интерфейсами подсети. Ниже приведены различные типы широковещательных адресов IPv4.

- **Широковещательный адрес сети.** Образуется путем установки равными 1 всех бит узла для префикса адреса сети с делением на классы. Примером широковещательного адреса сети для идентификатора сети с делением на классы 131.107.0.0/16 может служить адрес 131.107.255.255. Широковещательные адреса сети служат для рассылки пакетов на все интерфейсы сети с делением на классы. Маршрутизаторы IPv4 не переадресуют пакеты с широковещательных адресов сети.

- **Широковещательный адрес подсети**. Образуется путем установки равными 1 всех бит узла для префикса адреса бесклассовой сети. Примером широковещательного адреса сети для идентификатора бесклассовой сети 131.107.26.0/24 может служить адрес 131.107.26.255. Широковещательные адреса подсети служат для рассылки пакетов на все интерфейсы сети, не имеющей деления на классы. Маршрутизаторы IPv4 не переадресуют пакеты с широковещательных адресов подсети. Для префикса адреса сети с делением на классы не существует широковещательного адреса подсети, а только широковещательный адрес сети. Для префикса адреса бесклассовой сети не существует широковещательного адреса сети, а только широковещательный адрес подсети.

- **Широковещательный адрес, ориентированный на все подсети.** Образуется путем установки всех бит узла идентификатора исходной сети с делением на классы для префикса адреса бесклассовой сети равными 1. Пакет, посланный на адрес, который ориентирован на все подсети, должен достичь всех узлов всех подсетей идентификатора структурированной сети с делением на классы. Примером широковещательного адреса на все подсети для идентификатора структурированной сети 131.107.26.0/24 может служить 131.107.255.255. Широковещательный адрес, ориентированный на все подсети - это широковещательный адрес сети идентификатора исходной сети с делением на классы. Маршрутизаторы IPv4 могут переадресовывать пакеты с широковещательного адреса, ориентированного на все подсети, однако использование широковещательного адреса, ориентированного на все подсети, настоятельно не рекомендовано в документе RFC 1812.

-	**Адрес ограниченного широковещания**. Образуется путем установки всех 32 бит адреса IPv4 равным 1 (255.255.255.255). Адрес ограниченного широковещания используется для доставки пакетов с одного адреса всем адресам локальной подсети, когда идентификатор локальной сети неизвестен. Узлы IPv4 обычно используют адрес ограниченного широковещания только во время процесса автоматической настройки, например, протокола загрузки (BOOTP) или DHCP. Например, при работе с протоколом DHCP DHCP-клиент должен использовать адрес ограниченного широковещания для всего посылаемого трафика до тех пор, пока DHCP-сервер не подтвердит предлагаемую конфигурацию адреса IPv4. Маршрутизаторы IPv4 не переадресуют пакеты с адресов ограниченного широковещания. 

### IP-адреса используемые в локальных сетях

Все используемые в Интернете адреса, должны регистрироваться, что гарантирует их уникальность в масштабе всей планеты. Такие адреса называются реальными или публичными IP-адресами.

Для локальных сетей, не подключенных к Интернету, регистрация IP-адресов, естественно, не требуется, так как, в принципе, здесь можно использовать любые возможные адреса. Однако, чтобы не допускать возможность конфликтов при последующем подключении такой сети к интернету, рекомендуется применять в локальных сетях только следующие диапазоны так называемых частных IP-адресов (в интернете эти адреса не существуют и использовать их там нет возможности), представленных в таблице.

 [![Диапазоны](http://imgur.com/1Z9hA3b)](http://imgur.com/1Z9hA3b)
 
### Почему IPv4 хуже чем IPv6?

По большому счету, IPv6 является консервативным расширением IPv4. Например, приложениям, использующим транспортный, прикладной уровень и уровень протоколов нужно совсем мало или практических ни одного изменения для начала работы с IPv6. Исключение составляют приложения, использующие протоколы сетевого уровня и уровня адресации (например, FTPили NTPv3).

В приложения, как правило, нужно внести совсем небольшие изменения для начала работы с IPv6.

**Большеее адресное пространство**

Главной причиной, по которой нужно вносить эти изменения является большее адресное пространство: адреса в IPv6 имеют длину 128 бит, против 32 бит вIPv4.

Большее адресное пространство позволяет избежать потенциальную проблему исчерпания адресного пространства протокола IPv4 без необходимости замены системы NAT и других устройств, которые могут препятствовать сквозному прохождению интернет-трафика. Это также упрощает администрирование средних и крупных сетей, позволяя избежать использования сложных схем подсетей. Подсети, в идеале, должны вернуть себе изначальное предназначение - логическое разбиение IP-сети для оптимальной маршрутизации и обеспечения контроля доступа.

Недостатком больших размеров адреса в IPv6 является дополнительные накладные расходы за трафик IPv4, что может стать серьезной проблемой в регионах, где трафик сильно ограничен (использование сжатия заголовков может частично решить эту проблему).

**Автоконфигурация адресов**

Узел IPv6 может быть сконфигурирован автоматически при подключении к сети с IPv6-маршрутизацией с помощью протокола обмена сообщениями ICMPv6. При первом подключении, узел посылает запрос на получение своих конфигурационных параметров (router solicitation), и, если это возможно, маршрутизатор отправляет пакет с настройками сетевого уровня для данного узла (router advertisement).

Если IPv6 неприменима по каким-либо причинам, хост может использовать настройки соединения (DHCPv6) либо быть сконфигурирован вручную. Автоконфигурация не может быть использована маршрутизаторами, они должна настраиваться вручную или с помощью других средств.

**Широкополосное вещание**

Широкополосное вещание является частью базовых спецификаций IPv6, в отличие от IPv4, где оно было введено позднее.

IPv6 не имеет ссылку для локальной трансляции; этого же эффекта можно допиться путем широкополосного вещания для всей группы хостов (FF02:: 1).

Однако, большинство сред, в настоящее время не имеют развитых сетевых инфраструктур, настроенных широкополосное вещание: широкополосное вещание можно настроить для одной подсети, но глобальное широкополосное вещание работать не будет.

**Локальные ссылочные адреса**

IPv6 интерфейсы имеют локальные ссылочные адреса в дополнение к глобальным адресам, которые обычно используют приложения. Локальные адреса всегда присутствуют и никогда не изменяются, что заметно упрощает проектирование и конфигурирование протоколов маршрутизации.

Локальные ссылочные адреса часто используются при автоконфигурации при отсутствии внешнего источника сетевых параметров для данного узла.

**Джамбограммы**

В IPv4 размер пакетов ограничен 64 килобайтами полезной нагрузки. В IPv6появилась возможность обходить это ограничение за счет использования так называемых джамбограмм, которые позволяют использовать пакеты размером до 4 гигабайт. Использование джампограмм может существенно повысить производительность сетей.

**Сетевой слой безопасности**

IPsec, протокол для IP-сети, реализующий слой шифрования и аутентификации, является неотъемлемой частью базового протокола в IPv6, в отличие от IPv4, где он являлся опциональным (но, как правило, был реализован). Однако, в настоящее время протокол IPsec не получил широкого распространения и используется лишь для обеспечения обменом трафиком между IPv6 узлами и маршрутизаторами.

**Мобильность**

В отличие от мобильного IPv4, Мобильный IPv6 (MIPv6), позволяет избежать треугольной маршрутизации, оставаясь таким же эффективным, как и обычный IPv6. Но это преимущество довольно спорно, так как ни MIPv4, ни MIPv6 не получили широкого распространения.

**Упрощение обработки маршрутизаторами**

IPv4 имеет контрольную область, которая охватывает весь заголовок пакета. Некоторые области (например, поля TTL) изменяются в момент переадресации, и соответственно должна быть произведена перепроверка каждым маршрутизатором. IPv6 не имеет контроля ошибок на сетевом уровне, вместо этого он полагается на проверку ошибок на канальном транспортном уровнях.

### Заключение.

Давайте разберемся в чем у IPv4 и IPv6 разница. IPv6 - это Интернет-протокол шестой версии, также известный как IPng. IPng - это аббревиатура, которая расшифровывается как Интернет-протокол следующего поколения. Он является преемником IPv4 и предназначен для того, чтобы Интернет значительно расширился в отношении объема передаваемых данных и количества подключенных хостингов. Развитие Ipv6 началось после опасений, что спрос на IP-адреса будет превышать возможности IPv4. Эта версия включает в себя 128 бит, что равно 2*128. Это означает, что он может поддерживать больше устройств. IPv6-адреса записываются в шестнадцатеричном коде и разделяются двоеточиями, чтобы сделать их более читаемыми для людей.

Чтобы объяснить разницу между IPv4 и IPv6, нужно сравнить их различия. В IPv4 адресах - 32 бита, это значит, что они всего 4 бита в длину. В этой версии используется адрес (А) записи ресурсов в DNS для сопоставления хостинговых имен с адресами IPv4. Он также использует указатель (PTR) в IN-ADDR. ARPA DNS использует домены для сопоставления адресов IPv4 и хостинговых имен. Эта версия Интернет-протокола также создает дополнительно IPSec, который поддерживается извне. Заголовок в IPv4 - это не идентификатор потока пакетов для QoS обработки роутерами. Роутеры и хостинг-отправители могут вставлять пакеты в эту версию Интернет-протокола.

С другой стороны, Ipv6 совершенно другой. Эта версия предоставляет определенный формат для уменьшения обработки заголовка пакета роутерами. Различия заголовков пакетов IPv4 и IPv6 делает невозможным взаимодействие двух протоколов. Еще одна черта, делающая IPv6 более предпочтительным, это способность выполнять передачи одного пакета более, чем в один пункт назначения в рамках одной операции по отправке. У хостингов IPv6 есть трансграничный адрес с автоматической конфигурацией, что позволяет им автоматически настраиваться при подключении к сети IPv6 роутера через Интернет контроль сообщений версии протокола. Это делается через отправку цепочки локальных многоадресных запросов роутера для рассмотрения конфигурации. Если конфигурация прошла успешно, роутеры отвечают на запрос с объявлением роутером пакета, содержащего сетевой слой настройки конфигурации. В IPv6 процесс передачи пакетов и заголовков пакетов был упрощен, чтобы сделать его более эффективным для роутеров. Это непрерывной цепью расширяет основы Интернет-модели.

Когда этот день настанет и IPv4 станут быть бесполезными, то не будет другого выбора, кроме как переход на IPv6. Есть проблемы в таком переходе, но когда он, в конце концов, произойдет, его преимущества и многое другое придется всем по вкусу.















  
    
























### Development

Want to contribute? Great!

Dillinger uses Gulp + Webpack for fast developing.
Make a change in your file and instantanously see your updates!

Open your favorite Terminal and run these commands.

First Tab:
```sh
$ node app
```

Second Tab:
```sh
$ gulp watch
```

(optional) Third:
```sh
$ karma start
```

### Todos

 - Write Tests
 - Rethink Github Save
 - Add Code Comments
 - Add Night Mode

License
----

MIT


**Free Software, Hell Yeah!**

[//]: # (These are reference links used in the body of this note and get stripped out when the markdown processor does its job. There is no need to format nicely because it shouldn't be seen. Thanks SO - http://stackoverflow.com/questions/4823468/store-comments-in-markdown-syntax)


   [dill]: <https://github.com/joemccann/dillinger>
   [git-repo-url]: <https://github.com/joemccann/dillinger.git>
   [john gruber]: <http://daringfireball.net>
   [@thomasfuchs]: <http://twitter.com/thomasfuchs>
   [df1]: <http://daringfireball.net/projects/markdown/>
   [marked]: <https://github.com/chjj/marked>
   [Ace Editor]: <http://ace.ajax.org>
   [node.js]: <http://nodejs.org>
   [Twitter Bootstrap]: <http://twitter.github.com/bootstrap/>
   [keymaster.js]: <https://github.com/madrobby/keymaster>
   [jQuery]: <http://jquery.com>
   [@tjholowaychuk]: <http://twitter.com/tjholowaychuk>
   [express]: <http://expressjs.com>
   [AngularJS]: <http://angularjs.org>
   [Gulp]: <http://gulpjs.com>
   
   [PlDb]: <https://github.com/joemccann/dillinger/tree/master/plugins/dropbox/README.md>
   [PlGh]:  <https://github.com/joemccann/dillinger/tree/master/plugins/github/README.md>
   [PlGd]: <https://github.com/joemccann/dillinger/tree/master/plugins/googledrive/README.md>
   [PlOd]: <https://github.com/joemccann/dillinger/tree/master/plugins/onedrive/README.md>


